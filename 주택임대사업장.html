<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025ë…„ ì£¼íƒì„ëŒ€ì‚¬ì—…ì ìˆ˜ì…ê¸ˆì•¡ ê²€í† í‘œ (2025ê·€ì†)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        
        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            appearance: none;
        }

        .kakao-btn { background-color: #FEE500; color: #191919; }
        
        /* Tooltip Logic */
        .tooltip-text {
            visibility: hidden; opacity: 0; transition: opacity 0.3s;
        }
        .group:hover .tooltip-text, .group:active .tooltip-text {
            visibility: visible; opacity: 1;
        }

        /* Animation for new cards */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .property-card { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Browser Guide -->
    <div class="bg-gray-800 text-gray-200 text-xs p-3 text-center leading-relaxed">
        <i class="fas fa-info-circle mr-1 text-yellow-400"></i>
        í™”ë©´ì´ ì •ìƒì ìœ¼ë¡œ ë‚˜ì˜¤ì§€ ì•Šê±°ë‚˜ íŒŒì¼ì €ì¥ì´ ì•ˆë ê²½ìš°<br>ìš°ì¸¡ í•˜ë‹¨ <strong>[â‹®]</strong> â†’ <strong>[ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ ì—´ê¸°]</strong>ë¥¼ í•´ì£¼ì„¸ìš”.
    </div>

    <div class="max-w-3xl mx-auto bg-white min-h-screen shadow-lg pb-20 relative">
        <!-- Header -->
        <div class="bg-indigo-800 text-white p-6 rounded-b-xl shadow-md sticky top-0 z-20">
            <div class="flex justify-between items-start">
                <div>
                    <span class="bg-indigo-900 text-indigo-100 text-xs px-2 py-1 rounded font-bold mb-2 inline-block">2026ë…„ 2ì›” ì‹ ê³ ìš©</span>
                    <h1 class="text-xl font-bold leading-tight">ì£¼íƒì„ëŒ€ì‚¬ì—…ì<br>ìˆ˜ì…ê¸ˆì•¡ ê²€í† í‘œ</h1>
                </div>
                <div class="text-right">
                    <p class="text-xs text-indigo-200">ì´ ì„ëŒ€ë¬¼ê±´</p>
                    <p class="text-2xl font-bold" id="totalCountDisplay">0ê±´</p>
                </div>
            </div>
            <p class="text-indigo-200 text-xs mt-3 opacity-90">
                <i class="fas fa-check-circle mr-1"></i>ë¬¼ê±´ì´ ì—¬ëŸ¬ ê°œì´ê±°ë‚˜ ì„ì°¨ì¸ì´ ë°”ë€ ê²½ìš° ì¶”ê°€/ë³µì‚¬ ë²„íŠ¼ì„ í™œìš©í•˜ì„¸ìš”.
            </p>
        </div>

        <!-- Property List Container -->
        <div id="propertyList" class="p-4 space-y-6">
            <!-- Cards will be added here via JS -->
        </div>

        <!-- Add Button Area -->
        <div class="p-4">
            <button onclick="addProperty()" class="w-full border-2 border-dashed border-indigo-300 rounded-xl p-4 text-indigo-600 font-bold hover:bg-indigo-50 transition flex justify-center items-center">
                <i class="fas fa-plus-circle mr-2 text-xl"></i> ì„ëŒ€ ë¬¼ê±´ ì¶”ê°€í•˜ê¸°
            </button>
        </div>

        <!-- Footer Actions -->
        <div class="p-4 pb-10 space-y-3 bg-gray-50 border-t">
            <div class="flex justify-between items-center mb-2 px-1">
                <span class="text-sm font-bold text-gray-600">ì´ ìˆ˜ì…ê¸ˆì•¡ í•©ê³„</span>
                <span class="text-lg font-bold text-indigo-700" id="grandTotalDisplay">0ì›</span>
            </div>
            
            <button onclick="copyToClipboard()" class="kakao-btn w-full py-4 rounded-xl font-bold text-lg shadow-md hover:brightness-95 transition flex justify-center items-center">
                <i class="fas fa-comment mr-2"></i> ë³µì‚¬í•´ì„œ ì¹´í†¡ìœ¼ë¡œ ë³´ë‚´ê¸°
            </button>
            
            <button onclick="downloadTextFile()" class="bg-white border border-gray-300 text-gray-700 w-full py-3 rounded-xl font-bold shadow-sm hover:bg-gray-50 transition flex justify-center items-center">
                <i class="fas fa-file-download mr-2"></i> íŒŒì¼ë¡œ ì €ì¥í•˜ê¸° (.txt)
            </button>
        </div>
    </div>

    <!-- Template for Property Card -->
    <template id="propertyTemplate">
        <div class="property-card bg-white border-2 border-gray-200 rounded-xl shadow-sm overflow-hidden relative" data-id="">
            <!-- Card Header -->
            <div class="bg-gray-100 p-3 flex justify-between items-center border-b border-gray-200">
                <span class="font-bold text-indigo-800 text-sm card-number">No. 1</span>
                <!-- Delete Button -->
                <button type="button" class="delete-btn text-gray-400 hover:text-red-500 text-sm px-2 cursor-pointer border border-gray-300 rounded bg-white shadow-sm flex items-center">
                    <i class="fas fa-trash-alt mr-1"></i>ì‚­ì œ
                </button>
            </div>

            <div class="p-5 space-y-5">
                <!-- 1. Basic Info -->
                <div>
                    <h3 class="text-sm font-bold text-gray-800 mb-2 border-l-4 border-indigo-500 pl-2">ë¬¼ê±´ì§€ ì •ë³´</h3>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <select class="inp-houseType form-select col-span-2 w-full p-2 border border-gray-300 rounded text-sm">
                            <option value="" disabled selected>ì£¼íƒ ì¢…ë¥˜ ì„ íƒ</option>
                            <option value="ì•„íŒŒíŠ¸">ì•„íŒŒíŠ¸</option>
                            <option value="ë‹¤ì„¸ëŒ€ì£¼íƒ(ë¹Œë¼)">ë‹¤ì„¸ëŒ€ì£¼íƒ(ë¹Œë¼)</option>
                            <option value="ë‹¤ê°€êµ¬ì£¼íƒ(ì›ë£¸ ë“±)">ë‹¤ê°€êµ¬ì£¼íƒ(ì›ë£¸)</option>
                            <option value="ì˜¤í”¼ìŠ¤í…”(ì£¼ê±°ìš©)">ì˜¤í”¼ìŠ¤í…”(ì£¼ê±°ìš©)</option>
                            <option value="ë‹¨ë…ì£¼íƒ">ë‹¨ë…ì£¼íƒ</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mb-2">
                        <input type="text" class="inp-address col-span-2 p-2 border border-gray-300 rounded text-sm bg-gray-50" placeholder="ì£¼ì†Œ (ë„ë¡œëª…)">
                        <input type="text" class="inp-unit col-span-1 p-2 border border-gray-300 rounded text-sm bg-gray-50" placeholder="ë™/í˜¸ìˆ˜">
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-xs text-gray-500 block mb-1">ì·¨ë“ì¼</label>
                            <input type="date" class="inp-acqDate w-full p-2 border border-gray-300 rounded text-sm">
                        </div>
                        <div>
                            <label class="text-xs text-gray-500 block mb-1">ì „ìš©ë©´ì  (ã¡)</label>
                            <input type="number" class="inp-area w-full p-2 border border-gray-300 rounded text-sm text-right" placeholder="84.9" step="0.01">
                        </div>
                    </div>
                </div>

                <hr class="border-gray-100">

                <!-- 2. Tenant Info -->
                <div>
                    <h3 class="text-sm font-bold text-gray-800 mb-2 border-l-4 border-green-500 pl-2">ì„ì°¨ì¸ ì •ë³´</h3>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input type="text" class="inp-tName p-2 border border-gray-300 rounded text-sm" placeholder="ì„±ëª…(ìƒí˜¸)">
                        <input type="text" class="inp-tId p-2 border border-gray-300 rounded text-sm" placeholder="ì£¼ë¯¼(ì‚¬ì—…ì)ë²ˆí˜¸" maxlength="14">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 block mb-1">ì„ëŒ€ê¸°ê°„</label>
                        <div class="flex items-center space-x-1">
                            <input type="date" class="inp-rStart w-full p-2 border border-gray-300 rounded text-sm">
                            <span class="text-gray-400">~</span>
                            <input type="date" class="inp-rEnd w-full p-2 border border-gray-300 rounded text-sm">
                        </div>
                    </div>
                </div>

                <hr class="border-gray-100">

                <!-- 3. Rent Info -->
                <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                    <h3 class="text-sm font-bold text-indigo-900 mb-2">ì„ëŒ€ ì¡°ê±´ (2025ë…„ ê·€ì†)</h3>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div>
                            <label class="text-xs text-indigo-800 block">ë³´ì¦ê¸ˆ</label>
                            <input type="text" class="inp-deposit w-full p-2 border border-indigo-200 rounded text-sm text-right" placeholder="0">
                        </div>
                        <div>
                            <label class="text-xs text-indigo-800 block">ì›”ì„¸(ë§¤ì›”)</label>
                            <input type="text" class="inp-monthly w-full p-2 border border-indigo-200 rounded text-sm text-right" placeholder="0">
                        </div>
                    </div>
                    
                    <!-- Radio Buttons Container -->
                    <div class="pay-type-container flex space-x-2 mb-3">
                        <!-- JS will inject radio buttons here to handle unique names -->
                    </div>

                    <div>
                        <label class="text-xs font-bold text-indigo-900 block mb-1">2025ë…„ ì´ ì›”ì„¸ ìˆ˜ë ¹ì•¡</label>
                        <input type="text" class="inp-total w-full p-2 border-2 border-indigo-300 rounded text-sm text-right font-bold text-indigo-900 bg-white" placeholder="0">
                    </div>
                </div>

                <!-- Clone Button -->
                <button type="button" class="clone-btn w-full bg-gray-100 text-gray-600 text-xs py-2 rounded border border-gray-300 hover:bg-gray-200 transition">
                    <i class="fas fa-copy mr-1"></i> ì´ ë‚´ìš© ë³µì‚¬í•´ì„œ ì•„ë˜ì— ì¶”ê°€ (ì„ì°¨ì¸ ë³€ê²½ ì‹œ)
                </button>
            </div>
        </div>
    </template>

    <!-- Hidden TextArea for Copy -->
    <textarea id="clipboardTarget" style="position: absolute; left: -9999px;"></textarea>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none z-50 text-center text-sm w-max">
        âœ… ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.
    </div>

    <script>
        // --- Utilities ---
        const comma = (str) => String(str).replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
        const uncomma = (str) => String(str).replace(/[^\d]+/g, '');
        const formatInput = (e) => { e.target.value = comma(uncomma(e.target.value)); calculateGrandTotal(); };

        // --- Core Functions ---

        // 1. Add Property (New or Clone)
        function addProperty(data = null) {
            const template = document.getElementById('propertyTemplate');
            const clone = template.content.cloneNode(true);
            const card = clone.querySelector('.property-card');
            const uniqueId = Date.now() + Math.random().toString(36).substr(2, 9);
            
            card.dataset.id = uniqueId;

            // Handle Radio Buttons (Unique Name per Card)
            const payTypeContainer = card.querySelector('.pay-type-container');
            const payTypeName = `payType_${uniqueId}`;
            payTypeContainer.innerHTML = `
                <label class="flex-1 cursor-pointer">
                    <input type="radio" name="${payTypeName}" value="ì„ ë¶ˆ" class="hidden peer inp-payType">
                    <div class="py-1.5 text-center text-xs border rounded bg-white text-gray-500 peer-checked:bg-indigo-600 peer-checked:text-white transition">ì„ ë¶ˆ</div>
                </label>
                <label class="flex-1 cursor-pointer">
                    <input type="radio" name="${payTypeName}" value="í›„ë¶ˆ" class="hidden peer inp-payType" checked>
                    <div class="py-1.5 text-center text-xs border rounded bg-white text-gray-500 peer-checked:bg-indigo-600 peer-checked:text-white transition">í›„ë¶ˆ</div>
                </label>
            `;

            // === [ì¤‘ìš”] ì‚­ì œ ë²„íŠ¼ ì§ì ‘ ì´ë²¤íŠ¸ ì—°ê²° (ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•) ===
            const deleteBtn = card.querySelector('.delete-btn');
            deleteBtn.onclick = function() {
                // í˜„ì¬ ì¹´ë“œê°€ ëª‡ ë²ˆì§¸ì¸ì§€ í™•ì¸
                const allCards = document.querySelectorAll('.property-card');
                const myIndex = Array.from(allCards).indexOf(card);

                // 1ë²ˆ(Index 0)ì´ë©´ ì‚­ì œ ë¶ˆê°€
                if (myIndex === 0) {
                    alert("ì²« ë²ˆì§¸ ì„ëŒ€ ë¬¼ê±´ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? í•´ë‹¹ ì„ëŒ€ë¬¼ê±´ì˜ ë‚´ìš©ì´ ëª¨ë‘ ì§€ì›Œì§‘ë‹ˆë‹¤.')) {
                    card.remove(); // DOMì—ì„œ ì¦‰ì‹œ ì œê±°
                    renumberCards(); // ë²ˆí˜¸ ì¬ì •ë ¬
                    updateSummary(); // í•©ê³„ ê°±ì‹ 
                }
            };

            // Clone Event
            card.querySelector('.clone-btn').onclick = () => duplicateProperty(card);
            
            // Number Formatting
            ['.inp-deposit', '.inp-monthly', '.inp-total'].forEach(cls => {
                card.querySelector(cls).addEventListener('keyup', formatInput);
            });

            // Data Filling for Clone
            if (data) {
                card.querySelector('.inp-houseType').value = data.houseType;
                card.querySelector('.inp-address').value = data.address;
                card.querySelector('.inp-unit').value = data.unit;
                card.querySelector('.inp-acqDate').value = data.acqDate;
                card.querySelector('.inp-area').value = data.area;
                
                card.querySelector('.inp-deposit').value = data.deposit;
                card.querySelector('.inp-monthly').value = data.monthly;
                
                const radios = card.querySelectorAll(`input[name="${payTypeName}"]`);
                radios.forEach(r => {
                    if(r.value === data.payType) r.checked = true;
                });
                
                card.querySelector('.inp-tName').value = data.tName;
                card.querySelector('.inp-tId').value = data.tId;
                
                // [ìˆ˜ì •] ì„ëŒ€ê¸°ê°„ ë³µì‚¬ ì¶”ê°€
                card.querySelector('.inp-rStart').value = data.rStart;
                card.querySelector('.inp-rEnd').value = data.rEnd;

                setTimeout(() => card.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
            }

            document.getElementById('propertyList').appendChild(card);
            
            // UI Update
            renumberCards();
            updateSummary();
        }

        // 2. Duplicate Property logic
        function duplicateProperty(sourceCard) {
            const data = {
                houseType: sourceCard.querySelector('.inp-houseType').value,
                address: sourceCard.querySelector('.inp-address').value,
                unit: sourceCard.querySelector('.inp-unit').value,
                acqDate: sourceCard.querySelector('.inp-acqDate').value,
                area: sourceCard.querySelector('.inp-area').value,
                tName: sourceCard.querySelector('.inp-tName').value,
                tId: sourceCard.querySelector('.inp-tId').value,
                
                // [ìˆ˜ì •] ì„ëŒ€ê¸°ê°„ ë³µì‚¬ ë°ì´í„° ì¶”ê°€
                rStart: sourceCard.querySelector('.inp-rStart').value,
                rEnd: sourceCard.querySelector('.inp-rEnd').value,

                deposit: sourceCard.querySelector('.inp-deposit').value,
                monthly: sourceCard.querySelector('.inp-monthly').value,
                payType: sourceCard.querySelector('.inp-payType:checked')?.value || 'í›„ë¶ˆ'
            };
            addProperty(data);
            showToastMessage("ğŸ‘‡ ì•„ë˜ì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        // 3. Update UI (Numbers & Delete Button Visibility)
        function renumberCards() {
            const cards = document.querySelectorAll('.property-card');
            
            cards.forEach((card, index) => {
                // ë²ˆí˜¸ ì—…ë°ì´íŠ¸ (No. 1, No. 2...)
                card.querySelector('.card-number').innerText = `No. ${index + 1}`;
                
                // ì‚­ì œ ë²„íŠ¼ ì œì–´
                const deleteBtn = card.querySelector('.delete-btn');
                if (index === 0) {
                    deleteBtn.style.display = 'none'; // No.1ì€ ìˆ¨ê¹€
                } else {
                    deleteBtn.style.display = 'flex'; // ë‚˜ë¨¸ì§€ëŠ” í‘œì‹œ
                }
            });
        }

        function updateSummary() {
            const cards = document.querySelectorAll('.property-card');
            document.getElementById('totalCountDisplay').innerText = `${cards.length}ê±´`;
            calculateGrandTotal();
        }

        function calculateGrandTotal() {
            let total = 0;
            document.querySelectorAll('.inp-total').forEach(input => {
                total += parseInt(uncomma(input.value) || 0);
            });
            document.getElementById('grandTotalDisplay').innerText = comma(total) + "ì›";
        }

        function showToastMessage(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 2000);
        }

        // --- Data Gathering & Export ---

        function getFullData() {
            const cards = document.querySelectorAll('.property-card');
            if (cards.length === 0) {
                alert("ì„ëŒ€ ë¬¼ê±´ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì¶”ê°€í•´ì£¼ì„¸ìš”.");
                return null;
            }

            let text = `[2025 ì£¼íƒì„ëŒ€ ìˆ˜ì…ê¸ˆì•¡ ê²€í† í‘œ]\n`;
            text += `ì‘ì„±ì¼: ${new Date().toLocaleDateString()}\n`;
            text += `ì´ ë¬¼ê±´ ìˆ˜: ${cards.length}ê±´\n`;
            text += `================================\n\n`;

            let grandTotal = 0;

            cards.forEach((card, index) => {
                const houseType = card.querySelector('.inp-houseType').value;
                const address = card.querySelector('.inp-address').value;
                const unit = card.querySelector('.inp-unit').value;
                const area = card.querySelector('.inp-area').value;
                const tName = card.querySelector('.inp-tName').value;
                const rentTotal = card.querySelector('.inp-total').value;
                
                // Validation (Simple)
                if(!address) {
                    alert(`No.${index+1} ë¬¼ê±´ì˜ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
                    card.scrollIntoView({behavior:'smooth'});
                    return null;
                }

                grandTotal += parseInt(uncomma(rentTotal) || 0);

                text += `[No. ${index + 1}] ${address} ${unit}\n`;
                text += `- ì¢…ë¥˜: ${houseType}\n`;
                text += `- ë©´ì : ${area}ã¡ (ì „ìš©)\n`;
                text += `- ì·¨ë“: ${card.querySelector('.inp-acqDate').value}\n`;
                text += `- ì„ì°¨ì¸: ${tName} (${card.querySelector('.inp-tId').value})\n`;
                text += `- ê¸°ê°„: ${card.querySelector('.inp-rStart').value} ~ ${card.querySelector('.inp-rEnd').value}\n`;
                text += `- ì¡°ê±´: ë³´ì¦ê¸ˆ ${card.querySelector('.inp-deposit').value} / ì›”ì„¸ ${card.querySelector('.inp-monthly').value} (${card.querySelector('.inp-payType:checked').value})\n`;
                text += `> 2025ë…„ ìˆ˜ì…: ${rentTotal}ì›\n`;
                text += `--------------------------------\n\n`;
            });

            text += `================================\n`;
            text += `ğŸ’° ì´ ìˆ˜ì…ê¸ˆì•¡ í•©ê³„: ${comma(grandTotal)}ì›\n`;
            text += `================================\n`;
            
            return text;
        }

        function copyToClipboard() {
            const text = getFullData();
            if (!text) return;

            const target = document.getElementById('clipboardTarget');
            target.value = text;

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => showToastMessage("âœ… ì „ì²´ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.")).catch(() => fallbackCopy(target));
            } else {
                fallbackCopy(target);
            }
        }

        function fallbackCopy(element) {
            try {
                element.select();
                document.execCommand('copy');
                showToastMessage("âœ… ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
                element.blur();
            } catch (err) {
                alert("ë³µì‚¬ ì‹¤íŒ¨. í™”ë©´ ìº¡ì³ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.");
            }
        }

        function downloadTextFile() {
            const text = getFullData();
            if (!text) return;

            try {
                const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
                const anchor = document.createElement("a");
                anchor.href = window.URL.createObjectURL(blob);
                anchor.download = `2025_ì„ëŒ€í˜„í™©ì‹ ê³ ì„œ_ì´${document.querySelectorAll('.property-card').length}ê±´.txt`;
                document.body.appendChild(anchor);
                anchor.click();
                setTimeout(() => document.body.removeChild(anchor), 100);
            } catch (e) {
                alert("íŒŒì¼ ì €ì¥ ë¶ˆê°€ ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
            }
        }

        // Initialize with one card
        window.onload = () => addProperty();
    </script>
</body>
</html>
